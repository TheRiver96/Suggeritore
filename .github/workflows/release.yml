name: Create Release with Build Artifacts

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build for standalone deployment
        run: npm run build
        env:
          NODE_ENV: production
          # Build without base path for standalone usage
          VITE_BASE_PATH: /

      - name: Create distribution archive
        run: |
          cd dist
          zip -r ../suggeritore-${{ github.ref_name }}.zip .
          cd ..

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: suggeritore-${{ github.ref_name }}.zip
          generate_release_notes: true
          body: |
            ## ğŸ­ Suggeritore ${{ github.ref_name }}

            App per lo studio di copioni teatrali con annotazioni audio.

            ### ğŸ“¦ Download Offline Version

            Scarica il file ZIP e usalo offline:

            1. **Estrai l'archivio** in una cartella locale
            2. **Avvia un server HTTP** nella cartella estratta:
               ```bash
               # Con Python 3:
               python -m http.server 8000

               # Con Node.js (se hai npx):
               npx serve

               # Con PHP:
               php -S localhost:8000
               ```
            3. **Apri il browser** su http://localhost:8000

            ### ğŸŒ Live Demo

            Oppure usa la versione online (sempre aggiornata):
            **[https://TheRiver96.github.io/Suggeritore/](https://TheRiver96.github.io/Suggeritore/)**

            ### âœ¨ Features

            - ğŸ“„ Leggi PDF ed EPUB
            - ğŸ¤ Registra memo vocali collegati al testo
            - ğŸ”– Organizza annotazioni con tag
            - ğŸ” Ricerca full-text nelle note
            - ğŸ’¾ Storage locale (nessun dato inviato online)

            ---

            *Generato automaticamente da GitHub Actions*
